# 第18章 Web 主机托管

万维网早期，一般都是自己购买搭建服务器。但是随着 Web 的流行，越来越多的人开始使用由网络服务提供商提供的**专用 Web 服务器托管**服务。很多被托管的网站流量都不大，为了减小成本，Web 托管者让用户共享一台计算机的 Web 主机托管服务，这称为**共享主机托管**或**虚拟主机托管**。出于成本效益、空间和管理方面的考虑，Web 托管公司创建了成排同样的服务器，也就是**服务器集群**，把多个网站的流量负载分派在群里的服务器上。这样网站更加可靠了，而且每台服务器都一样，管理起来更方便了。

但是 HTTP 1.0的设计就没想到服务器的发展。HTTP 报文是头的第一行是 `GET /index.html`，路径是相对路径，特地省去了原以为冗余的主机信息。那在虚拟主机托管的情况下，服务器就不确定该给客户端返回哪个网站的 index.html 了。

为了解决这个问题，开始出现几种技术

### **1. 通过 URL 路径进行虚拟主机托管**

比如`GET /joe/index.html` 和 `GET /mary/index.html` 分别代表 Joe 和 Mary 网站的首页。但是这样比较多余，而且首页这么深也不太合理。

### **2. 通过端口号进行虚拟主机托管**

比如 Joe 用端口号 82，Mary 用83。但这样需要用户访问的 URL 中带端口号，也很麻烦。

### **3. 通过 IP 地址进行虚拟主机托管**

给每个网站都分配一个唯一 IP，然后多个 IP 地址绑在同一个物理服务器上。这样服务器能通过 IP 地址区分不同的网站请求。缺点是，IP 地址是有限的，而且服务器集群上，每一个服务器都得有对应数量的 IP。

### **4. 通过 HOST 首部进行虚拟主机托管。**

HOST 是 HTTP/1.0+就开始引入了，最后在规范在了 HTTP/1.1 中。HOST 描述了所请求资源所在的因特网主机和端口号，和原始 URL 中的主机和端口保持一致。

如果请求 URL 是绝对 URL，那就使用 URL 中的主机信息，忽略 Host 首部。如果不是绝对 URL，就用 Host 首部如果不是绝对 URL，也没有 Host 首部，就返回 400 错误。

而且客户端必须使用原始服务器的 Host，而不能传递代理的 Host。